---
import Layout from '@/layouts/Layout.astro';

const { slug } = Astro.params;

let res = await fetch(`https://status.netcintra.com.br/wp-json/wp/v2/posts?slug=${slug}&_embed`);
let [post] = await res.json();

// Function to format date
function formatDate(dateString: string) {
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// The getStaticPaths() is required for static Astro sites.
// If using SSR, you will not need this function.
export async function getStaticPaths() {
  let data = await fetch("https://status.netcintra.com.br/wp-json/wp/v2/posts?_embed");
  let posts = await data.json();

  return posts.map((post: any) => ({
    params: { slug: post.slug },
    props: { post: post },
  }));
}
---

<Layout>
  <div class="min-h-screen py-20 xl:px-20 px-8">
    <div class="max-w-4xl mx-auto">
      <!-- Back button -->
      <a 
        href="/status" 
        class="inline-flex items-center gap-2 text-white/80 hover:text-white mb-8 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Voltar para Status
      </a>

      <!-- Post container -->
      <article class="bg-gradient-to-br from-[#182E89] to-[#001158] rounded-2xl border-2 border-[#3B4E96] p-8 shadow-lg">
        <!-- Post header -->
        <div class="flex items-center gap-4 mb-6">
          <div class="w-3 h-3 rounded-full bg-primary animate-pulse"></div>
          <span class="text-white/60 text-sm">{formatDate(post.date)}</span>
        </div>

        <!-- Post title -->
        <h1 class="text-3xl font-bold text-white mb-8" set:html={post.title.rendered} />

        <!-- Post content -->
        <div class="prose prose-invert max-w-none">
          <Fragment set:html={post.content.rendered} />
        </div>
      </article>
    </div>
  </div>
</Layout>

<style>
  /* Style the WordPress content */
  .prose {
    color: rgb(229 229 229 / 0.8);
    line-height: 1.8;
  }
  .prose h2 {
    color: white;
    font-size: 1.5rem;
    margin: 2rem 0 1rem;
  }
  .prose p {
    margin: 1rem 0;
  }
  .prose ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    margin: 1rem 0;
  }
  .prose ol {
    list-style-type: decimal;
    padding-left: 1.5rem;
    margin: 1rem 0;
  }
  .prose a {
    color: var(--color-primary);
    text-decoration: underline;
  }
  .prose img {
    border-radius: 0.5rem;
    margin: 1.5rem 0;
    max-width: 100%;
    height: auto;
  }
</style>